<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ワッツ◎さーくる 楽曲ソート</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700;900&display=swap" rel="stylesheet">

<style>
body {
font-family: 'M PLUS Rounded 1c', Arial, sans-serif;
text-align: center;
background: linear-gradient(to bottom, #ffffff, #f0f0f0);
color: #333333;
margin: 0;
padding: 20px;
min-height: 100vh;
box-sizing: border-box;
}

h1, .card .title, .vs, .progress-text, button {
font-weight: 700;
}

h1 {
color: #000000;
margin-bottom: 10px;
font-size: 2.4em;
text-shadow: none;
}

.subtitle {
font-size: 1.2em;
margin-bottom: 20px;
color: #666666;
}

.progress-text {
font-size: 2em;
font-weight: 900;
color: #000000;
margin: 30px 0 20px;
}

.vs-container {
display: flex;
justify-content: center;
align-items: center;
gap: 20px;
margin: 20px auto;
flex-wrap: wrap;
}

.card {
flex: 1;
min-width: 280px;
max-width: 340px;
padding: 30px 15px; /* パディング減らしてコンパクトに */
background: #ffffff;
border-radius: 25px;
box-shadow: none;
cursor: pointer;
border: 3px solid #cccccc;
transition: none;
}

.card .title {
font-size: 1.8em;
font-weight: 900;
margin-bottom: 10px;
color: #000000;
}

.vs {
font-size: 3.5em;
font-weight: 900;
color: #000000;
flex-shrink: 0;
}

.buttons {
margin-top: 30px;
display: flex;
flex-direction: column;
align-items: center;
gap: 12px;
}

.draw-button, .undo-button, .restart {
padding: 12px 28px; /* 少し小さく */
font-size: 1.2em;
min-width: 260px;
border-radius: 15px;
cursor: pointer;
font-weight: 700;
box-shadow: none;
outline: none;
-webkit-appearance: none;
transition: background 0.2s;
}

.draw-button {
background: #e0e0e0;
color: #000000;
border: 2px solid #555555;
}

.draw-button:active {
background: #cccccc;
}

.undo-button {
background: #f5f5f5;
color: #444444;
border: 2px solid #888888;
}

.undo-button:active:not(:disabled) {
background: #e0e0e0;
}

.undo-button:disabled {
background: #f8f8f8;
color: #aaaaaa;
border-color: #cccccc;
cursor: not-allowed;
}

.result {
margin: 40px auto;
max-width: 800px;
}

.result h2 {
color: #000000;
font-size: 1.8em;
}

.result ol {
text-align: left;
background: #ffffff;
padding: 20px 30px;
border-radius: 20px;
box-shadow: none;
border: 2px solid #cccccc;
counter-reset: ranking;
}

.result li {
font-size: 1.3em;
padding: 10px 0;
color: #333333;
counter-increment: ranking;
}

.result li::before {
content: counter(ranking) "位 ";
color: #000000;
font-weight: 900;
font-size: 1.1em;
}

button.restart {
padding: 14px 30px;
font-size: 1.1em;
background: #e0e0e0;
color: #000000;
border: none;
border-radius: 15px;
cursor: pointer;
margin-top: 25px;
}

button.restart:active {
background: #cccccc;
}

/* スマホ専用調整（ここで全体を小さくして画面に収まるように！！） */
@media (max-width: 768px) {
body {
padding: 10px;
}
h1 {
font-size: 1.8em; /* タイトル小さく */
margin-bottom: 5px;
}
.subtitle {
font-size: 1.0em;
margin-bottom: 15px;
}
.progress-text {
font-size: 1.4em; /* 進捗小さく */
margin: 20px 0 15px;
}
.vs-container {
gap: 20px;
margin: 15px auto;
}
.vs {
font-size: 3.2em; /* VSも小さく */
margin: 10px 0;
}
.card {
width: 95%;
max-width: none;
padding: 25px 15px; /* さらにコンパクト */
}
.card .title {
font-size: 1.5em; /* 曲タイトル小さく */
}
.buttons {
margin-top: 20px;
gap: 10px;
}
.draw-button, .undo-button {
padding: 10px 24px;
font-size: 1.1em;
min-width: 240px;
width: 90%;
max-width: 300px;
}
.result h2 {
font-size: 1.6em;
}
.result li {
font-size: 1.2em;
padding: 8px 0;
}
}
</style>
</head>
<body>
<h1>ワッツ◎さーくる楽曲ソート</h1>
<div class="subtitle">好きな方をタップ！</div>

<div id="tournament">
<div class="progress-text" id="progress">進捗 0%</div>

<div class="vs-container">
<div class="card" id="left" onclick="choose('left')">
<div class="title"></div>
</div>
<div class="vs">VS</div>
<div class="card" id="right" onclick="choose('right')">
<div class="title"></div>
</div>
</div>

<div class="buttons">
<button class="draw-button" onclick="draw()">引き分け</button>
<button class="undo-button" id="undo" onclick="undo()" disabled>← 1つ前に戻る</button>
</div>
</div>

<div id="result" class="result" style="display:none;">
<h2>✨ランキング完成✨</h2>
<ol id="ranking"></ol>
<button class="restart" onclick="startTournament()">もう一度</button>
</div>

<script>
// マージソート方式スクリプト（前回と同じ）
const songs = [
"チャンス到来！ギガ盛スペクタクル",
"初恋結",
"臆病リボルター！",
"Summer Day Trip",
"薄明のポラリス",
"ミラクルサイリュウム",
"ユメ、ときどき君。",
"夏コイ花ビ",
"JU・GE・MU",
"ステップシーケンサー",
"スノービロード",
"ミライリライト",
"One way story",
"星空の彼方まで",
"ゲンダイクライマー",
"MAX！ハレルヤミュージック",
"イナズマトレイン",
"僕らの未来予想図",
"始まりはいつだって\"ド\"",
"回るよ！クルクル◎どーなっつ",
"真紅のマーガレット〜21枚目の\"スキ\"〜",
"青の日々~spring time of life~",
"まだまだまだ、最前線",
"終わりはいつだって初めの一歩",
"サマサマ☆サマトピア",
"真っ白なコンパス",
"なんでもない青空"
];

let lists = [];
let battles = [];
let history = [];
let totalComparisons = 0;

function startTournament() {
lists = songs.map(title => [title]);
battles = [];
history = [];
totalComparisons = calculateTotalComparisons(songs.length);
generateNextBattles();
document.getElementById('tournament').style.display = 'block';
document.getElementById('result').style.display = 'none';
document.getElementById('undo').disabled = true;
updateProgress();
showNextBattle();
}

function calculateTotalComparisons(n) {
return Math.floor(n * Math.log2(n)) - n + 1;
}

function generateNextBattles() {
battles = [];
for (let i = 0; i < lists.length; i += 2) {
if (i + 1 < lists.length) {
battles.push({left: lists[i], right: lists[i + 1]});
}
}
}

function showNextBattle() {
if (battles.length === 0) {
const finalRanking = lists[0].reverse();
showResult(finalRanking);
return;
}

const battle = battles[0];
const leftTitle = battle.left[battle.left.length - 1];
const rightTitle = battle.right[battle.right.length - 1];

document.querySelector('#left .title').textContent = leftTitle;
document.querySelector('#right .title').textContent = rightTitle;
}

function recordHistory() {
history.push({
lists: lists.map(list => [...list]),
battles: battles.map(b => ({
left: [...b.left],
right: [...b.right]
}))
});
document.getElementById('undo').disabled = false;
}

function mergeAndContinue(winnerList, loserList) {
const merged = [...winnerList, ...loserList];
battles.shift();
const index = lists.findIndex(l => l === winnerList || l === loserList);
lists[index] = merged;
lists = lists.filter((_, i) => i % 2 === 0 || i === lists.length - 1);

updateProgress();
generateNextBattles();
showNextBattle();
}

function choose(side) {
recordHistory();
const battle = battles[0];
const winnerList = side === 'left' ? battle.left : battle.right;
const loserList = side === 'left' ? battle.right : battle.left;
mergeAndContinue(winnerList, loserList);
}

function draw() {
recordHistory();
const battle = battles[0];
if (Math.random() < 0.5) {
mergeAndContinue(battle.left, battle.right);
} else {
mergeAndContinue(battle.right, battle.left);
}
}

function undo() {
if (history.length === 0) return;
const prev = history.pop();
lists = prev.lists.map(list => [...list]);
battles = prev.battles.map(b => ({
left: [...b.left],
right: [...b.right]
}));
document.getElementById('undo').disabled = history.length === 0;
updateProgress();
showNextBattle();
}

function updateProgress() {
const completed = songs.length - lists.length;
const percent = totalComparisons > 0 ? Math.round((completed / totalComparisons) * 100) : 0;
document.getElementById('progress').textContent = `進捗 ${percent}%`;
}

function showResult(finalRanking) {
document.getElementById('tournament').style.display = 'none';
const rankingList = document.getElementById('ranking');
rankingList.innerHTML = '';
finalRanking.forEach(title => {
const li = document.createElement('li');
li.textContent = title;
rankingList.appendChild(li);
});
document.getElementById('result').style.display = 'block';
}

startTournament();
</script>
</body>
</html>